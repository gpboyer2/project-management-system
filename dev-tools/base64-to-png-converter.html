<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Base64 è½¬ PNG å·¥å…·</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #5e72e4 0%, #825ee4 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .main-content {
            padding: 40px;
        }

        .input-section {
            margin-bottom: 40px;
        }

        .section-title {
            font-size: 1.4em;
            color: #333;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title::before {
            content: '';
            width: 4px;
            height: 24px;
            background: #5e72e4;
            border-radius: 2px;
        }

        .input-wrapper {
            position: relative;
            margin-bottom: 20px;
        }

        textarea {
            width: 100%;
            min-height: 200px;
            padding: 20px;
            border: 2px solid #e0e6ed;
            border-radius: 10px;
            font-size: 14px;
            font-family: 'Consolas', 'Monaco', monospace;
            resize: vertical;
            transition: all 0.3s ease;
            background: #f8f9fc;
        }

        textarea:focus {
            outline: none;
            border-color: #5e72e4;
            background: white;
            box-shadow: 0 0 0 3px rgba(94, 114, 228, 0.1);
        }

        textarea::placeholder {
            color: #a0aec0;
        }

        .input-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
            font-size: 0.9em;
            color: #718096;
        }

        .char-count {
            padding: 5px 10px;
            background: #edf2f7;
            border-radius: 5px;
        }

        .button-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 30px;
        }

        button {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #48bb78;
            color: white;
        }

        .btn-secondary:hover {
            background: #38a169;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(72, 187, 120, 0.4);
        }

        .btn-danger {
            background: #f56565;
            color: white;
        }

        .btn-danger:hover {
            background: #e53e3e;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(245, 101, 101, 0.4);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }

        .preview-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-top: 40px;
        }

        .preview-card {
            background: #f7fafc;
            border-radius: 10px;
            padding: 20px;
            border: 2px solid #e2e8f0;
            transition: all 0.3s ease;
        }

        .preview-card:hover {
            border-color: #cbd5e0;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        .preview-card h3 {
            color: #2d3748;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .image-container {
            background: white;
            border-radius: 8px;
            padding: 10px;
            min-height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px dashed #cbd5e0;
        }

        .preview-image {
            max-width: 100%;
            max-height: 300px;
            border-radius: 4px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .placeholder {
            color: #a0aec0;
            text-align: center;
            padding: 40px;
        }

        .placeholder svg {
            width: 80px;
            height: 80px;
            margin-bottom: 10px;
            opacity: 0.5;
        }

        .file-info {
            margin-top: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            font-size: 0.9em;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding: 5px 0;
            border-bottom: 1px solid #e2e8f0;
        }

        .info-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .info-label {
            color: #718096;
            font-weight: 500;
        }

        .info-value {
            color: #2d3748;
            font-weight: 600;
        }

        .message {
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                transform: translateY(-20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .message-success {
            background: #c6f6d5;
            color: #22543d;
            border: 1px solid #9ae6b4;
        }

        .message-error {
            background: #fed7d7;
            color: #742a2a;
            border: 1px solid #fc8181;
        }

        .message-info {
            background: #bee3f8;
            color: #2c5282;
            border: 1px solid #90cdf4;
        }

        .hidden {
            display: none !important;
        }

        .download-section {
            background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
            border-radius: 10px;
            padding: 30px;
            margin-top: 30px;
            text-align: center;
        }

        .download-section h3 {
            color: #2d3748;
            margin-bottom: 20px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #e2e8f0;
        }

        .stat-value {
            font-size: 2em;
            font-weight: 700;
            color: #5e72e4;
        }

        .stat-label {
            color: #718096;
            margin-top: 5px;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e2e8f0;
        }

        .tab {
            padding: 10px 20px;
            background: none;
            border: none;
            color: #718096;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
            margin-bottom: -2px;
        }

        .tab:hover {
            color: #4a5568;
        }

        .tab.active {
            color: #5e72e4;
            border-bottom-color: #5e72e4;
            font-weight: 600;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .code-view {
            background: #1a202c;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 14px;
            line-height: 1.5;
            white-space: pre-wrap;
            word-break: break-all;
            max-height: 400px;
            overflow-y: auto;
        }

        @media (max-width: 768px) {
            .header {
                padding: 30px 20px;
            }

            .header h1 {
                font-size: 2em;
            }

            .main-content {
                padding: 20px;
            }

            .preview-section {
                grid-template-columns: 1fr;
            }

            .button-group {
                flex-direction: column;
            }

            button {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ–¼ï¸ Base64 è½¬ PNG å·¥å…·</h1>
            <p>å°† Base64 å›¾ç‰‡å­—ç¬¦ä¸²è½¬æ¢ä¸º PNG æ ¼å¼ï¼Œæ”¯æŒæ‰¹é‡è½¬æ¢å’Œä¸‹è½½</p>
        </div>

        <div class="main-content">
            <div id="messageContainer"></div>

            <div class="input-section">
                <h2 class="section-title">è¾“å…¥ Base64 å­—ç¬¦ä¸²</h2>

                <div class="input-wrapper">
                    <textarea
                        id="base64Input"
                        placeholder="è¯·ç²˜è´´æ‚¨çš„ Base64 å­—ç¬¦ä¸²...

æ”¯æŒçš„æ ¼å¼ï¼š
â€¢ data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAA...
â€¢ data:image/jpeg;base64,/9j/4AAQSkZJRgABAQ...
â€¢ æˆ–ç›´æ¥ç²˜è´´çº¯ Base64 å­—ç¬¦ä¸²ï¼ˆä¸åŒ…å« data:image å‰ç¼€ï¼‰"></textarea>
                    <div class="input-info">
                        <span class="char-count" id="charCount">0 å­—ç¬¦</span>
                        <span id="inputSize">çº¦ 0 KB</span>
                    </div>
                </div>

                <div class="button-group">
                    <button class="btn-primary" onclick="convertToPNG()">
                        <span>ğŸ”„</span> è½¬æ¢ä¸º PNG
                    </button>
                    <button class="btn-secondary" onclick="pasteFromClipboard()">
                        <span>ğŸ“‹</span> ä»å‰ªè´´æ¿ç²˜è´´
                    </button>
                    <button class="btn-secondary" onclick="loadExample()">
                        <span>ğŸ“</span> åŠ è½½ç¤ºä¾‹
                    </button>
                    <button class="btn-danger" onclick="clearAll()">
                        <span>ğŸ—‘ï¸</span> æ¸…ç©º
                    </button>
                </div>
            </div>

            <div id="resultSection" class="hidden">
                <div class="tabs">
                    <button class="tab active" onclick="switchTab('preview')">é¢„è§ˆ</button>
                    <button class="tab" onclick="switchTab('info')">ä¿¡æ¯</button>
                    <button class="tab" onclick="switchTab('code')">ä»£ç </button>
                </div>

                <!-- é¢„è§ˆæ ‡ç­¾ -->
                <div class="tab-content" id="previewTab">
                    <div class="preview-section">
                        <div class="preview-card">
                            <h3>ğŸ“¥ åŸå§‹å›¾ç‰‡</h3>
                            <div class="image-container">
                                <img id="originalImage" class="preview-image hidden" alt="åŸå§‹å›¾ç‰‡">
                                <div id="originalPlaceholder" class="placeholder">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                        <circle cx="8.5" cy="8.5" r="1.5"></circle>
                                        <polyline points="21 15 16 10 5 21"></polyline>
                                    </svg>
                                    <p>åŸå§‹å›¾ç‰‡é¢„è§ˆ</p>
                                </div>
                            </div>
                        </div>

                        <div class="preview-card">
                            <h3>ğŸ“¤ è½¬æ¢å PNG</h3>
                            <div class="image-container">
                                <img id="convertedImage" class="preview-image hidden" alt="è½¬æ¢åå›¾ç‰‡">
                                <div id="convertedPlaceholder" class="placeholder">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                        <polyline points="14 2 14 8 20 8"></polyline>
                                        <line x1="16" y1="13" x2="8" y2="13"></line>
                                        <line x1="16" y1="17" x2="8" y2="17"></line>
                                        <polyline points="10 9 9 9 8 9"></polyline>
                                    </svg>
                                    <p>PNG æ ¼å¼é¢„è§ˆ</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ä¿¡æ¯æ ‡ç­¾ -->
                <div class="tab-content hidden" id="infoTab">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="originalSizeStat">0 KB</div>
                            <div class="stat-label">åŸå§‹å¤§å°</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="convertedSizeStat">0 KB</div>
                            <div class="stat-label">PNG å¤§å°</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="imageDimensions">0Ã—0</div>
                            <div class="stat-label">å›¾ç‰‡å°ºå¯¸</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="colorDepth">-</div>
                            <div class="stat-label">é¢œè‰²æ·±åº¦</div>
                        </div>
                    </div>

                    <div class="file-info">
                        <div class="info-item">
                            <span class="info-label">åŸå§‹æ ¼å¼ï¼š</span>
                            <span class="info-value" id="originalFormat">-</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">è½¬æ¢æ ¼å¼ï¼š</span>
                            <span class="info-value">PNG</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">æ˜¯å¦é€æ˜ï¼š</span>
                            <span class="info-value" id="hasTransparency">-</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">è½¬æ¢æ—¶é—´ï¼š</span>
                            <span class="info-value" id="convertTime">-</span>
                        </div>
                    </div>
                </div>

                <!-- ä»£ç æ ‡ç­¾ -->
                <div class="tab-content hidden" id="codeTab">
                    <h3 style="margin-bottom: 15px;">PNG Base64 ä»£ç ï¼š</h3>
                    <div class="code-view" id="codeOutput"></div>
                    <div class="button-group" style="margin-top: 20px;">
                        <button class="btn-secondary" onclick="copyBase64()">
                            <span>ğŸ“‹</span> å¤åˆ¶ Base64
                        </button>
                        <button class="btn-secondary" onclick="copyHTML()">
                            <span>ğŸ“„</span> å¤åˆ¶ HTML æ ‡ç­¾
                        </button>
                        <button class="btn-secondary" onclick="copyCSS()">
                            <span>ğŸ¨</span> å¤åˆ¶ CSS
                        </button>
                    </div>
                </div>

                <div class="download-section">
                    <h3>ğŸ’¾ ä¸‹è½½é€‰é¡¹</h3>
                    <div class="button-group" style="justify-content: center;">
                        <button class="btn-primary" onclick="downloadPNG()">
                            <span>â¬‡ï¸</span> ä¸‹è½½ PNG æ–‡ä»¶
                        </button>
                        <button class="btn-secondary" onclick="downloadAsText()">
                            <span>ğŸ“„</span> ä¸‹è½½ Base64 æ–‡æœ¬
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let originalData = null;
        let convertedData = null;
        let convertStartTime = 0;

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            const input = document.getElementById('base64Input');
            input.addEventListener('input', updateCharCount);

            // è‡ªåŠ¨è°ƒæ•´æ–‡æœ¬æ¡†é«˜åº¦
            input.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = this.scrollHeight + 'px';
            });
        });

        // æ›´æ–°å­—ç¬¦è®¡æ•°
        function updateCharCount() {
            const input = document.getElementById('base64Input');
            const charCount = document.getElementById('charCount');
            const inputSize = document.getElementById('inputSize');

            const count = input.value.length;
            charCount.textContent = count + ' å­—ç¬¦';

            // ä¼°ç®—å¤§å°ï¼ˆBase64 çº¦ä¸ºåŸå›¾çš„ 4/3ï¼‰
            const sizeKB = (count * 0.75 / 1024).toFixed(2);
            inputSize.textContent = `çº¦ ${sizeKB} KB`;
        }

        // æ˜¾ç¤ºæ¶ˆæ¯
        function showMessage(message, type = 'info') {
            const container = document.getElementById('messageContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message message-${type}`;

            let icon = '';
            switch(type) {
                case 'success':
                    icon = 'âœ…';
                    break;
                case 'error':
                    icon = 'âŒ';
                    break;
                default:
                    icon = 'â„¹ï¸';
            }

            messageDiv.innerHTML = `<span>${icon}</span> ${message}`;
            container.appendChild(messageDiv);

            // 5ç§’åè‡ªåŠ¨ç§»é™¤
            setTimeout(() => {
                messageDiv.remove();
            }, 5000);
        }

        // æ¸…ç† Base64 å­—ç¬¦ä¸²
        function cleanBase64(base64) {
            if (!base64) return '';

            // ç§»é™¤ data:image å‰ç¼€
            if (base64.includes(',')) {
                base64 = base64.split(',')[1];
            }

            // ç§»é™¤æ‰€æœ‰ç©ºç™½å­—ç¬¦
            return base64.replace(/\s/g, '');
        }

        // æ£€æµ‹å›¾ç‰‡æ ¼å¼
        function detectImageFormat(base64) {
            try {
                const binaryString = atob(base64.substring(0, 100));
                const bytes = new Uint8Array(binaryString.length);

                for (let i = 0; i < binaryString.length; i++) {
                    bytes[i] = binaryString.charCodeAt(i);
                }

                // æ£€æŸ¥æ–‡ä»¶å¤´
                if (bytes[0] === 0x89 && bytes[1] === 0x50 && bytes[2] === 0x4E && bytes[3] === 0x47) {
                    return 'png';
                } else if (bytes[0] === 0xFF && bytes[1] === 0xD8 && bytes[2] === 0xFF) {
                    return 'jpeg';
                } else if (bytes[0] === 0x47 && bytes[1] === 0x49 && bytes[2] === 0x46) {
                    return 'gif';
                } else if (bytes[0] === 0x42 && bytes[1] === 0x4D) {
                    return 'bmp';
                } else if (bytes[0] === 0x52 && bytes[1] === 0x49 && bytes[2] === 0x46 && bytes[3] === 0x46 &&
                          bytes[8] === 0x57 && bytes[9] === 0x45 && bytes[10] === 0x42 && bytes[11] === 0x50) {
                    return 'webp';
                } else if (bytes[0] === 0x3C) {
                    // å¯èƒ½æ˜¯ SVG
                    return 'svg';
                }

                return 'unknown';
            } catch (e) {
                return 'unknown';
            }
        }

        // è½¬æ¢ä¸º PNG
        async function convertToPNG() {
            const input = document.getElementById('base64Input').value.trim();

            if (!input) {
                showMessage('è¯·è¾“å…¥ Base64 å­—ç¬¦ä¸²ï¼', 'error');
                return;
            }

            convertStartTime = Date.now();
            showMessage('æ­£åœ¨è½¬æ¢ä¸­...', 'info');

            try {
                const cleanedBase64 = cleanBase64(input);
                const originalFormat = detectImageFormat(cleanedBase64);

                if (originalFormat === 'unknown') {
                    showMessage('æ— æ³•è¯†åˆ«çš„å›¾ç‰‡æ ¼å¼ï¼', 'error');
                    return;
                }

                // åˆ›å»ºå›¾ç‰‡å¯¹è±¡
                const img = new Image();
                img.onload = function() {
                    // åˆ›å»º canvas
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');

                    canvas.width = this.width;
                    canvas.height = this.height;

                    // å¦‚æœæ˜¯ PNGï¼Œä¿æŒé€æ˜åº¦
                    if (originalFormat !== 'png') {
                        ctx.fillStyle = 'white';
                        ctx.fillRect(0, 0, canvas.width, canvas.height);
                    }

                    // ç»˜åˆ¶å›¾ç‰‡
                    ctx.drawImage(this, 0, 0);

                    // è½¬æ¢ä¸º PNG
                    const pngBase64 = canvas.toDataURL('image/png');
                    const pngCleanBase64 = cleanBase64(pngBase64);

                    // ä¿å­˜æ•°æ®
                    originalData = {
                        format: originalFormat,
                        base64: cleanedBase64,
                        dataUrl: `data:image/${originalFormat === 'jpg' ? 'jpeg' : originalFormat};base64,${cleanedBase64}`,
                        width: this.width,
                        height: this.height,
                        size: cleanedBase64.length * 0.75
                    };

                    convertedData = {
                        format: 'png',
                        base64: pngCleanBase64,
                        dataUrl: pngBase64,
                        width: this.width,
                        height: this.height,
                        size: pngCleanBase64.length * 0.75
                    };

                    // æ˜¾ç¤ºç»“æœ
                    displayResults();

                    const convertTime = Date.now() - convertStartTime;
                    showMessage(`è½¬æ¢æˆåŠŸï¼è€—æ—¶ ${convertTime}ms`, 'success');
                };

                img.onerror = function() {
                    showMessage('å›¾ç‰‡åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ Base64 å­—ç¬¦ä¸²æ˜¯å¦æ­£ç¡®ï¼', 'error');
                };

                img.src = originalData ? originalData.dataUrl : `data:image/${originalFormat === 'jpg' ? 'jpeg' : originalFormat};base64,${cleanedBase64}`;

            } catch (error) {
                showMessage('è½¬æ¢å¤±è´¥ï¼š' + error.message, 'error');
                console.error(error);
            }
        }

        // æ˜¾ç¤ºç»“æœ
        function displayResults() {
            if (!originalData || !convertedData) return;

            // æ˜¾ç¤ºç»“æœåŒºåŸŸ
            document.getElementById('resultSection').classList.remove('hidden');

            // æ˜¾ç¤ºåŸå§‹å›¾ç‰‡
            const originalImg = document.getElementById('originalImage');
            originalImg.src = originalData.dataUrl;
            originalImg.classList.remove('hidden');
            document.getElementById('originalPlaceholder').classList.add('hidden');

            // æ˜¾ç¤ºè½¬æ¢åçš„å›¾ç‰‡
            const convertedImg = document.getElementById('convertedImage');
            convertedImg.src = convertedData.dataUrl;
            convertedImg.classList.remove('hidden');
            document.getElementById('convertedPlaceholder').classList.add('hidden');

            // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
            document.getElementById('originalSizeStat').textContent = formatFileSize(originalData.size);
            document.getElementById('convertedSizeStat').textContent = formatFileSize(convertedData.size);
            document.getElementById('imageDimensions').textContent = `${originalData.width}Ã—${originalData.height}`;
            document.getElementById('originalFormat').textContent = originalData.format.toUpperCase();

            // æ£€æµ‹é€æ˜åº¦
            const hasTransparency = checkTransparency();
            document.getElementById('hasTransparency').textContent = hasTransparency ? 'æ˜¯' : 'å¦';
            document.getElementById('colorDepth').textContent = hasTransparency ? '32ä½ (RGBA)' : '24ä½ (RGB)';

            // è½¬æ¢æ—¶é—´
            const convertTime = Date.now() - convertStartTime;
            document.getElementById('convertTime').textContent = `${convertTime} ms`;

            // æ˜¾ç¤ºä»£ç 
            document.getElementById('codeOutput').textContent = convertedData.dataUrl;
        }

        // æ£€æŸ¥é€æ˜åº¦
        function checkTransparency() {
            if (!originalData || originalData.format !== 'png') return false;

            try {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                const img = new Image();

                img.src = originalData.dataUrl;
                ctx.drawImage(img, 0, 0);

                const imageData = ctx.getImageData(0, 0, 1, 1);
                return imageData.data[3] < 255;
            } catch (e) {
                return false;
            }
        }

        // æ ¼å¼åŒ–æ–‡ä»¶å¤§å°
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // åˆ‡æ¢æ ‡ç­¾
        function switchTab(tabName) {
            // æ›´æ–°æ ‡ç­¾æ ·å¼
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');

            // åˆ‡æ¢å†…å®¹
            document.querySelectorAll('.tab-content').forEach(content => content.classList.add('hidden'));
            document.getElementById(tabName + 'Tab').classList.remove('hidden');
        }

        // ä¸‹è½½ PNG
        function downloadPNG() {
            if (!convertedData) {
                showMessage('æ²¡æœ‰å¯ä¸‹è½½çš„æ•°æ®ï¼', 'error');
                return;
            }

            const a = document.createElement('a');
            a.href = convertedData.dataUrl;
            a.download = `converted_image_${Date.now()}.png`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);

            showMessage('PNG æ–‡ä»¶ä¸‹è½½æˆåŠŸï¼', 'success');
        }

        // ä¸‹è½½ä¸ºæ–‡æœ¬
        function downloadAsText() {
            if (!convertedData) {
                showMessage('æ²¡æœ‰å¯ä¸‹è½½çš„æ•°æ®ï¼', 'error');
                return;
            }

            const blob = new Blob([convertedData.dataUrl], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `base64_png_${Date.now()}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            showMessage('Base64 æ–‡æœ¬ä¸‹è½½æˆåŠŸï¼', 'success');
        }

        // å¤åˆ¶ Base64
        function copyBase64() {
            if (!convertedData) {
                showMessage('æ²¡æœ‰å¯å¤åˆ¶çš„æ•°æ®ï¼', 'error');
                return;
            }

            navigator.clipboard.writeText(convertedData.dataUrl).then(() => {
                showMessage('Base64 å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼', 'success');
            }).catch(err => {
                showMessage('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶ï¼', 'error');
            });
        }

        // å¤åˆ¶ HTML
        function copyHTML() {
            if (!convertedData) {
                showMessage('æ²¡æœ‰å¯å¤åˆ¶çš„æ•°æ®ï¼', 'error');
                return;
            }

            const html = `<img src="${convertedData.dataUrl}" alt="PNG Image">`;
            navigator.clipboard.writeText(html).then(() => {
                showMessage('HTML æ ‡ç­¾å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼', 'success');
            }).catch(err => {
                showMessage('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶ï¼', 'error');
            });
        }

        // å¤åˆ¶ CSS
        function copyCSS() {
            if (!convertedData) {
                showMessage('æ²¡æœ‰å¯å¤åˆ¶çš„æ•°æ®ï¼', 'error');
                return;
            }

            const css = `background-image: url('${convertedData.dataUrl}');`;
            navigator.clipboard.writeText(css).then(() => {
                showMessage('CSS ä»£ç å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼', 'success');
            }).catch(err => {
                showMessage('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶ï¼', 'error');
            });
        }

        // ä»å‰ªè´´æ¿ç²˜è´´
        async function pasteFromClipboard() {
            try {
                const text = await navigator.clipboard.readText();
                document.getElementById('base64Input').value = text;
                updateCharCount();
                showMessage('å·²ä»å‰ªè´´æ¿ç²˜è´´ï¼', 'success');
            } catch (err) {
                showMessage('æ— æ³•è®¿é—®å‰ªè´´æ¿ï¼Œè¯·æ‰‹åŠ¨ç²˜è´´ï¼', 'error');
            }
        }

        // åŠ è½½ç¤ºä¾‹
        function loadExample() {
            // 1x1 åƒç´ çš„çº¢è‰² PNG Base64
            const exampleBase64 = 'iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mP8z/C/HgAGgwJ/lK3Q6wAAAABJRU5ErkJggg==';
            document.getElementById('base64Input').value = exampleBase64;
            updateCharCount();
            showMessage('å·²åŠ è½½ç¤ºä¾‹ Base64ï¼Œç‚¹å‡»"è½¬æ¢ä¸º PNG"æŸ¥çœ‹æ•ˆæœï¼', 'info');
        }

        // æ¸…ç©ºæ‰€æœ‰
        function clearAll() {
            document.getElementById('base64Input').value = '';
            document.getElementById('resultSection').classList.add('hidden');
            document.getElementById('originalImage').classList.add('hidden');
            document.getElementById('convertedImage').classList.add('hidden');
            document.getElementById('originalPlaceholder').classList.remove('hidden');
            document.getElementById('convertedPlaceholder').classList.remove('hidden');

            originalData = null;
            convertedData = null;

            updateCharCount();
            showMessage('å·²æ¸…ç©ºæ‰€æœ‰å†…å®¹ï¼', 'info');
        }
    </script>
</body>
</html>