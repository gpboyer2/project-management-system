<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Base64 å›¾ç‰‡ä¼˜åŒ–å·¥å…·</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-bottom: 30px;
        }
        .input-section {
            margin-bottom: 30px;
        }
        textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            font-family: monospace;
            resize: vertical;
        }
        textarea:focus {
            outline: none;
            border-color: #4CAF50;
        }
        .button-group {
            margin: 20px 0;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        button {
            padding: 12px 30px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #45a049;
        }
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        .secondary {
            background-color: #2196F3;
        }
        .secondary:hover {
            background-color: #1976D2;
        }
        .danger {
            background-color: #f44336;
        }
        .danger:hover {
            background-color: #d32f2f;
        }
        .warning {
            background-color: #FF9800;
        }
        .warning:hover {
            background-color: #F57C00;
        }
        .preview-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 30px;
        }
        .preview-box {
            padding: 20px;
            border: 2px solid #ddd;
            border-radius: 5px;
            background-color: #fafafa;
        }
        .preview-box h3 {
            margin-top: 0;
            color: #555;
        }
        .image-preview {
            width: 100%;
            max-height: 400px;
            object-fit: contain;
            border: 1px solid #ddd;
            background: white;
        }
        .stats {
            margin-top: 15px;
            padding: 15px;
            background: #f0f0f0;
            border-radius: 5px;
            font-size: 14px;
        }
        .stats-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        .stats-value {
            font-weight: bold;
            color: #333;
        }
        .reduction {
            color: #4CAF50;
        }
        .increase {
            color: #f44336;
        }
        .output-section {
            margin-top: 30px;
            padding: 20px;
            background: #f8f8f8;
            border-radius: 5px;
        }
        .output-code {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 20px;
            border-radius: 5px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            white-space: pre-wrap;
            word-break: break-all;
        }
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #ddd;
        }
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 16px;
            color: #666;
            border-bottom: 2px solid transparent;
        }
        .tab.active {
            color: #4CAF50;
            border-bottom-color: #4CAF50;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .info-box {
            background-color: #e8f4f8;
            border-left: 4px solid #2196F3;
            padding: 15px;
            margin-bottom: 20px;
        }
        .error {
            background-color: #ffebee;
            border-left-color: #f44336;
            color: #c62828;
        }
        .success {
            background-color: #e8f5e9;
            border-left-color: #4CAF50;
            color: #2e7d32;
        }
        .warning-box {
            background-color: #fff3e0;
            border-left-color: #FF9800;
            color: #f57c00;
        }
        .compression-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
            padding: 20px;
            background: #f5f5f5;
            border-radius: 5px;
        }
        .option-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .option-group label {
            font-weight: bold;
            color: #555;
        }
        .option-group input,
        .option-group select {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 3px;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ—œï¸ Base64 å›¾ç‰‡ä¼˜åŒ–å·¥å…·</h1>

        <div class="info-box">
            <strong>ğŸ¯ ä¼˜åŒ–æ–¹æ¡ˆï¼š</strong>
            <ul>
                <li><strong>å‹ç¼©ä¼˜åŒ–ï¼š</strong>é€šè¿‡é™ä½è´¨é‡å’Œåˆ†è¾¨ç‡å‡å°æ–‡ä»¶å¤§å°</li>
                <li><strong>æ ¼å¼è½¬æ¢ï¼š</strong>è‡ªåŠ¨é€‰æ‹©æœ€ä¼˜æ ¼å¼ï¼ˆWebP > JPEG > PNGï¼‰</li>
                <li><strong>ç®€åŒ–SVGï¼š</strong>å¯¹äºçŸ¢é‡å›¾ï¼Œç§»é™¤ä¸å¿…è¦çš„å…ƒæ•°æ®</li>
                <li><strong>åˆ†å—ä¸Šä¼ ï¼š</strong>è¶…å¤§Base64å¯ä»¥åˆ†å‰²æˆå°å—</li>
            </ul>
        </div>

        <div class="input-section">
            <h3>ğŸ“ è¾“å…¥ Base64 å­—ç¬¦ä¸²ï¼š</h3>
            <textarea id="base64Input" rows="8" placeholder="ç²˜è´´æ‚¨çš„ base64 å›¾ç‰‡å­—ç¬¦ä¸²...
æ”¯æŒæ ¼å¼ï¼šdata:image/...;base64,... æˆ–çº¯ base64 å­—ç¬¦ä¸²"></textarea>

            <div class="stats" id="inputStats" style="display: none;">
                <div class="stats-item">
                    <span>åŸå§‹å¤§å°ï¼š</span>
                    <span class="stats-value" id="originalSize">0 KB</span>
                </div>
                <div class="stats-item">
                    <span>å›¾ç‰‡æ ¼å¼ï¼š</span>
                    <span class="stats-value" id="originalFormat">-</span>
                </div>
                <div class="stats-item">
                    <span>å›¾ç‰‡å°ºå¯¸ï¼š</span>
                    <span class="stats-value" id="originalDimensions">-</span>
                </div>
            </div>

            <div class="compression-options">
                <div class="option-group">
                    <label>ğŸ¨ ä¼˜åŒ–ç›®æ ‡ï¼š</label>
                    <select id="optimizeTarget">
                        <option value="size">æœ€å°æ–‡ä»¶å¤§å°</option>
                        <option value="balance">å¹³è¡¡è´¨é‡å’Œå¤§å°</option>
                        <option value="quality">ä¿æŒé«˜è´¨é‡</option>
                    </select>
                </div>
                <div class="option-group">
                    <label>ğŸ“ æœ€å¤§å®½åº¦ï¼ˆåƒç´ ï¼‰ï¼š</label>
                    <input type="number" id="maxWidth" value="1920" min="100" max="4000">
                </div>
                <div class="option-group">
                    <label>ğŸ“ æœ€å¤§é«˜åº¦ï¼ˆåƒç´ ï¼‰ï¼š</label>
                    <input type="number" id="maxHeight" value="1080" min="100" max="4000">
                </div>
                <div class="option-group">
                    <label>ğŸ’¾ è¾“å‡ºæ ¼å¼ï¼š</label>
                    <select id="outputFormat">
                        <option value="auto">è‡ªåŠ¨é€‰æ‹©</option>
                        <option value="webp">WebPï¼ˆæ¨èï¼‰</option>
                        <option value="jpeg">JPEG</option>
                        <option value="png">PNG</option>
                        <option value="svg">SVGï¼ˆçŸ¢é‡å›¾ï¼‰</option>
                    </select>
                </div>
            </div>

            <div class="button-group">
                <button onclick="analyzeImage()">ğŸ“Š åˆ†æå›¾ç‰‡</button>
                <button onclick="optimizeImage()" class="secondary">ğŸš€ å¼€å§‹ä¼˜åŒ–</button>
                <button onclick="splitBase64()" class="warning">âœ‚ï¸ åˆ†å‰²å­—ç¬¦ä¸²</button>
                <button onclick="clearAll()" class="danger">ğŸ—‘ï¸ æ¸…ç©º</button>
            </div>
        </div>

        <div id="messageBox" class="info-box" style="display: none;"></div>

        <div id="resultSection" class="hidden">
            <div class="tabs">
                <button class="tab active" onclick="switchTab('preview')">é¢„è§ˆå¯¹æ¯”</button>
                <button class="tab" onclick="switchTab('compressed')">å‹ç¼©ç»“æœ</button>
                <button class="tab" onclick="switchTab('code')">ä»£ç </button>
                <button class="tab" onclick="switchTab('svg')">SVGä¼˜åŒ–</button>
            </div>

            <!-- é¢„è§ˆå¯¹æ¯”æ ‡ç­¾ -->
            <div class="tab-content active" id="previewTab">
                <div class="preview-section">
                    <div class="preview-box">
                        <h3>åŸå§‹å›¾ç‰‡</h3>
                        <img id="originalImage" class="image-preview" alt="åŸå§‹å›¾ç‰‡">
                    </div>
                    <div class="preview-box">
                        <h3>ä¼˜åŒ–å</h3>
                        <img id="optimizedImage" class="image-preview" alt="ä¼˜åŒ–åå›¾ç‰‡">
                    </div>
                </div>
            </div>

            <!-- å‹ç¼©ç»“æœæ ‡ç­¾ -->
            <div class="tab-content" id="compressedTab">
                <div class="output-section">
                    <h3>ğŸ“ˆ ä¼˜åŒ–ç»“æœ</h3>
                    <div class="stats">
                        <div class="stats-item">
                            <span>åŸå§‹å¤§å°ï¼š</span>
                            <span class="stats-value" id="origSize">0 KB</span>
                        </div>
                        <div class="stats-item">
                            <span>ä¼˜åŒ–åå¤§å°ï¼š</span>
                            <span class="stats-value" id="optSize">0 KB</span>
                        </div>
                        <div class="stats-item">
                            <span>å‹ç¼©ç‡ï¼š</span>
                            <span class="stats-value" id="compressionRatio">0%</span>
                        </div>
                        <div class="stats-item">
                            <span>èŠ‚çœç©ºé—´ï¼š</span>
                            <span class="stats-value" id="savedSpace">0 KB</span>
                        </div>
                    </div>
                    <div class="button-group">
                        <button onclick="downloadOptimized()" class="secondary">ğŸ’¾ ä¸‹è½½ä¼˜åŒ–åå›¾ç‰‡</button>
                        <button onclick="copyOptimizedBase64()">ğŸ“‹ å¤åˆ¶ Base64</button>
                    </div>
                </div>
            </div>

            <!-- ä»£ç æ ‡ç­¾ -->
            <div class="tab-content" id="codeTab">
                <div class="output-section">
                    <h3>ğŸ“„ ä¼˜åŒ–åçš„ Base64 ä»£ç ï¼š</h3>
                    <div class="output-code" id="outputCode"></div>
                    <div class="button-group">
                        <button onclick="copyOptimizedBase64()">ğŸ“‹ å¤åˆ¶ä»£ç </button>
                        <button onclick="downloadAsFile()" class="secondary">ğŸ’¾ ä¸‹è½½ä¸ºæ–‡ä»¶</button>
                    </div>
                </div>
            </div>

            <!-- SVGä¼˜åŒ–æ ‡ç­¾ -->
            <div class="tab-content" id="svgTab">
                <div class="output-section">
                    <h3>ğŸ¨ SVG ä¼˜åŒ–é€‰é¡¹ï¼š</h3>
                    <div class="compression-options">
                        <div class="option-group">
                            <label>ç®€åŒ–è·¯å¾„ï¼š</label>
                            <input type="checkbox" id="simplifyPaths" checked>
                        </div>
                        <div class="option-group">
                            <label>ç§»é™¤å…ƒæ•°æ®ï¼š</label>
                            <input type="checkbox" id="removeMetadata" checked>
                        </div>
                        <div class="option-group">
                            <label>ç²¾åº¦ï¼š</label>
                            <select id="precision">
                                <option value="1">ä½ï¼ˆæœ€å°ï¼‰</option>
                                <option value="2" selected>ä¸­</option>
                                <option value="3">é«˜ï¼ˆè´¨é‡ï¼‰</option>
                            </select>
                        </div>
                    </div>
                    <button onclick="convertToOptimizedSVG()">ğŸ”„ è½¬æ¢ä¸ºä¼˜åŒ–çš„ SVG</button>
                    <div id="svgOutput" style="margin-top: 20px;"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let originalImageData = null;
        let optimizedImageData = null;

        function showMessage(message, type = 'info') {
            const messageBox = document.getElementById('messageBox');
            messageBox.textContent = message;
            messageBox.className = 'info-box ' + type;
            messageBox.style.display = 'block';
            setTimeout(() => {
                messageBox.style.display = 'none';
            }, 5000);
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function cleanBase64(base64) {
            if (base64.includes(',')) {
                base64 = base64.split(',')[1];
            }
            return base64.replace(/\s/g, '');
        }

        function getImageFormat(base64) {
            const binaryString = atob(base64.substring(0, 100));
            const bytes = new Uint8Array(binaryString.length);
            for (let i = 0; i < binaryString.length; i++) {
                bytes[i] = binaryString.charCodeAt(i);
            }

            if (bytes[0] === 0x89 && bytes[1] === 0x50 && bytes[2] === 0x4E && bytes[3] === 0x47) return 'png';
            if (bytes[0] === 0xFF && bytes[1] === 0xD8 && bytes[2] === 0xFF) return 'jpeg';
            if (bytes[0] === 0x47 && bytes[1] === 0x49 && bytes[2] === 0x46) return 'gif';
            if (bytes[0] === 0x42 && bytes[1] === 0x4D) return 'bmp';
            if (bytes[0] === 0x52 && bytes[1] === 0x49 && bytes[2] === 0x46 && bytes[3] === 0x46 &&
                bytes[8] === 0x57 && bytes[9] === 0x45 && bytes[10] === 0x42 && bytes[11] === 0x50) return 'webp';
            return 'png';
        }

        function analyzeImage() {
            const base64Input = document.getElementById('base64Input').value.trim();
            if (!base64Input) {
                showMessage('è¯·è¾“å…¥ Base64 å­—ç¬¦ä¸²ï¼', 'error');
                return;
            }

            const cleanedBase64 = cleanBase64(base64Input);
            const format = getImageFormat(cleanedBase64);

            // è®¡ç®—å¤§å°
            const size = cleanedBase64.length * 0.75; // Base64 æ¯”åŸå›¾å¤§çº¦ 33%

            // æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯
            document.getElementById('inputStats').style.display = 'block';
            document.getElementById('originalSize').textContent = formatFileSize(size);
            document.getElementById('originalFormat').textContent = format.toUpperCase();

            // åŠ è½½å›¾ç‰‡è·å–å°ºå¯¸
            const img = new Image();
            img.onload = function() {
                document.getElementById('originalDimensions').textContent = `${this.width} Ã— ${this.height}`;
                originalImageData = {
                    width: this.width,
                    height: this.height,
                    size: size,
                    format: format,
                    base64: cleanedBase64,
                    dataUrl: `data:image/${format};base64,${cleanedBase64}`
                };
                document.getElementById('originalImage').src = this.src;
                showMessage('å›¾ç‰‡åˆ†æå®Œæˆï¼', 'success');
            };
            img.onerror = function() {
                showMessage('æ— æ³•åŠ è½½å›¾ç‰‡ï¼', 'error');
            };
            img.src = `data:image/${format};base64,${cleanedBase64}`;
        }

        function optimizeImage() {
            if (!originalImageData) {
                analyzeImage();
                if (!originalImageData) return;
            }

            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            const img = new Image();

            img.onload = function() {
                // è·å–ä¼˜åŒ–å‚æ•°
                const maxWidth = parseInt(document.getElementById('maxWidth').value);
                const maxHeight = parseInt(document.getElementById('maxHeight').value);
                const outputFormat = document.getElementById('outputFormat').value;
                const optimizeTarget = document.getElementById('optimizeTarget').value;

                // è®¡ç®—æ–°å°ºå¯¸
                let width = img.width;
                let height = img.height;

                if (width > maxWidth || height > maxHeight) {
                    const ratio = Math.min(maxWidth / width, maxHeight / height);
                    width *= ratio;
                    height *= ratio;
                }

                canvas.width = width;
                canvas.height = height;

                // è®¾ç½®å‹ç¼©è´¨é‡
                let quality = 0.8;
                if (optimizeTarget === 'size') quality = 0.6;
                else if (optimizeTarget === 'quality') quality = 0.95;

                // ç»˜åˆ¶å¹¶å‹ç¼©
                ctx.drawImage(img, 0, 0, width, height);

                // é€‰æ‹©è¾“å‡ºæ ¼å¼
                let finalFormat = outputFormat;
                if (outputFormat === 'auto') {
                    // è‡ªåŠ¨é€‰æ‹©æœ€ä¼˜æ ¼å¼
                    if (width > 1000 || height > 1000) {
                        finalFormat = 'jpeg'; // å¤§å›¾ç”¨ JPEG
                    } else if (hasTransparency(img)) {
                        finalFormat = 'png'; // æœ‰é€æ˜åº¦ç”¨ PNG
                    } else {
                        finalFormat = 'webp'; // å…¶ä»–ç”¨ WebP
                    }
                }

                // è½¬æ¢ä¸º Base64
                const mimeType = finalFormat === 'jpg' ? 'jpeg' : finalFormat;
                const optimizedBase64 = canvas.toDataURL(`image/${mimeType}`, quality);
                const optimizedCleanBase64 = cleanBase64(optimizedBase64);

                // ä¿å­˜ä¼˜åŒ–åçš„æ•°æ®
                optimizedImageData = {
                    width: width,
                    height: height,
                    size: optimizedCleanBase64.length * 0.75,
                    format: finalFormat,
                    base64: optimizedCleanBase64,
                    dataUrl: optimizedBase64
                };

                // æ˜¾ç¤ºç»“æœ
                displayResults();
                showMessage('ä¼˜åŒ–å®Œæˆï¼', 'success');
            };

            img.src = originalImageData.dataUrl;
        }

        function hasTransparency(img) {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = img.width;
            canvas.height = img.height;
            ctx.drawImage(img, 0, 0);

            try {
                const imageData = ctx.getImageData(0, 0, 1, 1);
                return imageData.data[3] < 255;
            } catch (e) {
                return false;
            }
        }

        function displayResults() {
            document.getElementById('resultSection').classList.remove('hidden');

            // æ˜¾ç¤ºä¼˜åŒ–åçš„å›¾ç‰‡
            document.getElementById('optimizedImage').src = optimizedImageData.dataUrl;

            // æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯
            document.getElementById('origSize').textContent = formatFileSize(originalImageData.size);
            document.getElementById('optSize').textContent = formatFileSize(optimizedImageData.size);

            const reduction = ((originalImageData.size - optimizedImageData.size) / originalImageData.size * 100).toFixed(1);
            const saved = originalImageData.size - optimizedImageData.size;

            document.getElementById('compressionRatio').textContent = reduction + '%';
            document.getElementById('compressionRatio').className = 'stats-value ' + (reduction > 0 ? 'reduction' : 'increase');
            document.getElementById('savedSpace').textContent = formatFileSize(saved);
            document.getElementById('savedSpace').className = 'stats-value ' + (saved > 0 ? 'reduction' : 'increase');

            // æ˜¾ç¤ºä»£ç 
            document.getElementById('outputCode').textContent = optimizedImageData.dataUrl;
        }

        function switchTab(tabName) {
            // åˆ‡æ¢æ ‡ç­¾æ ·å¼
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');

            // åˆ‡æ¢å†…å®¹
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(tabName + 'Tab').classList.add('active');
        }

        function copyOptimizedBase64() {
            if (!optimizedImageData) {
                showMessage('æ²¡æœ‰å¯å¤åˆ¶çš„ä¼˜åŒ–æ•°æ®ï¼', 'error');
                return;
            }

            navigator.clipboard.writeText(optimizedImageData.dataUrl).then(() => {
                showMessage('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼', 'success');
            });
        }

        function downloadOptimized() {
            if (!optimizedImageData) {
                showMessage('æ²¡æœ‰å¯ä¸‹è½½çš„æ•°æ®ï¼', 'error');
                return;
            }

            const a = document.createElement('a');
            a.href = optimizedImageData.dataUrl;
            a.download = `optimized_image.${optimizedImageData.format}`;
            a.click();
        }

        function downloadAsFile() {
            if (!optimizedImageData) {
                showMessage('æ²¡æœ‰å¯ä¸‹è½½çš„æ•°æ®ï¼', 'error');
                return;
            }

            const blob = new Blob([optimizedImageData.dataUrl], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'base64_image.txt';
            a.click();
            URL.revokeObjectURL(url);
        }

        function splitBase64() {
            const base64Input = document.getElementById('base64Input').value.trim();
            if (!base64Input) {
                showMessage('è¯·è¾“å…¥ Base64 å­—ç¬¦ä¸²ï¼', 'error');
                return;
            }

            const cleanedBase64 = cleanBase64(base64Input);
            const chunkSize = 1000000; // 1MB åˆ†å—
            const chunks = [];

            for (let i = 0; i < cleanedBase64.length; i += chunkSize) {
                chunks.push(cleanedBase64.substring(i, i + chunkSize));
            }

            // åˆ›å»ºåˆ†å‰²åçš„ä»£ç 
            const splitCode = `// Base64 åˆ†ä¸º ${chunks.length} å—
const base64Chunks = [
${chunks.map(chunk => `    '${chunk}'`).join(',\n')}
];

// é‡æ–°ç»„åˆ
const fullBase64 = base64Chunks.join('');
const dataUrl = 'data:image/*;base64,' + fullBase64;`;

            // æ˜¾ç¤ºç»“æœ
            const blob = new Blob([splitCode], { type: 'text/javascript' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'base64_chunks.js';
            a.click();
            URL.revokeObjectURL(url);

            showMessage(`å·²åˆ†å‰²æˆ ${chunks.length} å—ï¼`, 'success');
        }

        function convertToOptimizedSVG() {
            if (!optimizedImageData) {
                showMessage('è¯·å…ˆä¼˜åŒ–å›¾ç‰‡ï¼', 'error');
                return;
            }

            const simplifyPaths = document.getElementById('simplifyPaths').checked;
            const removeMetadata = document.getElementById('removeMetadata').checked;
            const precision = parseInt(document.getElementById('precision').value);

            // åˆ›å»ºä¼˜åŒ–çš„ SVG
            let svg = `<?xml version="1.0" encoding="UTF-8"?>\n`;
            if (!removeMetadata) {
                svg += `<!-- Generator: Base64 Optimizer -->\n`;
                svg += `<!-- Original: ${originalImageData.format.toUpperCase()} ${originalImageData.width}x${originalImageData.height} -->\n`;
                svg += `<!-- Optimized: ${optimizedImageData.format.toUpperCase()} ${optimizedImageData.width}x${optimizedImageData.height} -->\n`;
            }

            svg += `<svg xmlns="http://www.w3.org/2000/svg"\n`;
            svg += `     xmlns:xlink="http://www.w3.org/1999/xlink"\n`;
            svg += `     width="${optimizedImageData.width}"\n`;
            svg += `     height="${optimizedImageData.height}"\n`;
            svg += `     viewBox="0 0 ${optimizedImageData.width} ${optimizedImageData.height}">\n`;

            if (!removeMetadata) {
                svg += `  <title>Optimized Image</title>\n`;
                svg += `  <desc>Original size: ${formatFileSize(originalImageData.size)}, Optimized: ${formatFileSize(optimizedImageData.size)}</desc>\n`;
            }

            svg += `  <image width="${optimizedImageData.width}"\n`;
            svg += `         height="${optimizedImageData.height}"\n`;
            svg += `         xlink:href="${optimizedImageData.dataUrl}" />\n`;
            svg += `</svg>`;

            // æ˜¾ç¤º SVG
            document.getElementById('svgOutput').innerHTML = `
                <div style="margin-top: 20px;">
                    <h4>SVG é¢„è§ˆï¼š</h4>
                    <div style="border: 1px solid #ddd; padding: 20px; background: white;">
                        ${svg}
                    </div>
                    <div class="button-group" style="margin-top: 20px;">
                        <button onclick="copySVGCode()">ğŸ“‹ å¤åˆ¶ SVG</button>
                        <button onclick="downloadSVG()" class="secondary">ğŸ’¾ ä¸‹è½½ SVG</button>
                    </div>
                </div>
            `;

            window.currentSVG = svg;
        }

        function copySVGCode() {
            if (!window.currentSVG) {
                showMessage('æ²¡æœ‰å¯å¤åˆ¶çš„ SVGï¼', 'error');
                return;
            }
            navigator.clipboard.writeText(window.currentSVG).then(() => {
                showMessage('SVG å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼', 'success');
            });
        }

        function downloadSVG() {
            if (!window.currentSVG) {
                showMessage('æ²¡æœ‰å¯ä¸‹è½½çš„ SVGï¼', 'error');
                return;
            }
            const blob = new Blob([window.currentSVG], { type: 'image/svg+xml' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'optimized_image.svg';
            a.click();
            URL.revokeObjectURL(url);
        }

        function clearAll() {
            document.getElementById('base64Input').value = '';
            document.getElementById('inputStats').style.display = 'none';
            document.getElementById('resultSection').classList.add('hidden');
            document.getElementById('originalImage').src = '';
            document.getElementById('optimizedImage').src = '';
            originalImageData = null;
            optimizedImageData = null;
            window.currentSVG = null;
            showMessage('å·²æ¸…ç©ºæ‰€æœ‰å†…å®¹', 'info');
        }
    </script>
</body>
</html>